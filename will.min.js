/*!
 * WillJS JavaScript Library v1.2
 * http://github.com/kawamanza/will.js
 *
 * Copyright 2011, Marcelo Manzan
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Date: Wed Dec 21 11:14:44 2011 -0200
 */
(function(m,B,j){function w(a,b){this.name=a;b&&s(this,false)}function n(a){return typeof a==="string"}function t(a){return K.call(a)==="[object Array]"}function p(a){return typeof a!=="object"}function q(a){return typeof a==="function"}function C(a,b,c){var d,e;n(b)&&(b=b.split(/\./));d=b.shift();if(b.length==0)a[d]=c;else{e=a[d];if(p(e)||t(e))e={},a[d]=e;C(e,b,c)}}function k(a,b,c){var d="",e,f=arguments.length;f<3&&(c=b,b=a,a=this);n(b)?(d=b+".",b=c):f==2&&(a=b,b=c);for(e in b)C(a,d+e,b[e]);return a}
function u(a){var b=j,c;n(a)?(a=a.split(/[\?#]/)[0],/^([\w\-\.]+)\@(.+)$/.test(a)?b=[RegExp.$1,RegExp.$2]:(c=a.split(/\//),c=c[c.length-1],b=[L.test(c)?RegExp.$1:c,a],/\.css$/.test(b[1])&&(c=b[1].split(/\/+/),/^\^?(\w+:|)$/.test(c[0])&&c.shift(),c.pop(),c.push(b[0]),b[0]=c.join("_").replace(/:/,"-")))):(c=a.getAttribute("src")||a.getAttribute("href"),b=[a.getAttribute(D),(c||"").split(/[\?#]/)[0]],!b[0]&&b[1]&&(b=u(b[1])));b.length==2&&(b.push(/\.css$/.test(b[1])),b.push(b[2]?"link":"script"),b.push(/^\^/.test(b[1])),
b[4]&&(b[1]=b[1].substr(1)));return b}function M(a){var b=u(a),c=b[0],d=b[1],e=b[2],b=v.getElementsByTagName(b[3]),f,g=b.length,h;for(f=0;f<g;)if(h=b[f++],u(h)[0]===c)return/\@/.test(a)&&e&&h.getAttribute("href")!=d&&h.setAttribute("href",d),[e,h];return false}function N(a,b,c){var d=false;a.onload=a.onreadystatechange=function(){var b=this.readyState;if(!d&&(!b||b==="loaded"||b==="complete"))d=true,c("success"),a.onload=a.onreadystatechange=j,a.onerror=a.onabort=j};a.onerror=a.onabort=function(){d=
true;c("error");a.onload=a.onreadystatechange=j;a.onerror=a.onabort=j;b&&a.parentNode&&b.removeChild(a)}}function O(a,b,c,d){var e=v.getElementsByTagName("head")[0]||v.documentElement,b=u(b),f=b[2],g=a.cfg.queryString,a=v.createElement(b[3]);a.setAttribute(D,b[0]);f&&a.setAttribute("rel","stylesheet");a[f?"href":"src"]=b[1]+(g?"?"+g:"");f||N(a,e,d);b[4]&&e.firstChild?e.insertBefore(a,c||e.firstChild):e.appendChild(a);f&&d("success",a)}function E(a,b,c){var d=a.cfg.mode===l.modes.PROD,e=a.cfg.queryString,
f=false,g=m.location,h=a.cfg.debug,a=/^(\w+:)?\/\/([^\/]+)/.test(b)&&(RegExp.$2!=g.host||RegExp.$1&&RegExp.$1!=g.protocol);e&&(d=true,b=b+"?"+e);m.jQuery.ajax({dataType:a?"jsonp":"html",success:function(a){f||(f=true,h&&h(" * successful loaded "+b),c(200,a))},complete:function(a){f||(f=true,h&&h(" * completed "+b),c(a.status,a.responseText))},cache:d,url:b})}function r(a){return{queue:[],active:false,run:a,sched:function(){var a=this;setTimeout(function(){a.process()},0)},process:function(a){var c=
this,d=c.queue;if(arguments.length){if(p(a)||!t(a))a=[a];d.push(a);setTimeout(function(){if(d.length&&!c.active)c.active=true,c.process()},2)}else if(d.length){a=d.shift();try{c.run.apply(c,a)!==false&&c.sched()}catch(e){throw c.sched(),e;}}else c.active=false}}}function s(a,b,c){if(b||!("cfg"in a))k(a,l.u.getConfig()),"call"in a||k(a,i);q(c)&&c(a.cfg)}function F(a,b){var c=b.packageName,d=b.domainName,d=a[d]||(a[d]={}),c=d[c]||(d[c]={}),d=b.name;return c[d]||(c[d]={rescue:function(){}})}function x(a,
b,c){var d=function(){return c.apply(a,arguments)},e="impl";n(c)&&(e=c,c=b[e]);b[e]=function(){var f=arguments,g=b.assets||b.libs;if(g&&g.length)y(a,"loadDependenciesAndCall",[a,b,f]);else return b[e]=e=="impl"?d:c,b[e].apply(b,f)}}function z(a,b,c,d){if(!p(c)){var e=c.impl||q(c.getImpl)&&c.getImpl(a),f=c.assets||c.libs;if(q(e))b=F(b,d),b.assets=p(f)||!t(f)?[]:f,x(a,b,e),b.rescue=c.rescue||b.rescue;else for(e in c)d.name=e,z(a,b,c[e],d)}}function A(a,b,c){var a=a.cfg,d=a.domains,e="local",f=a.defaultPackage,
g=b.toString();if(/^(?:(\w+):)?(?:(\w+)\.)?(\w+)$/.test(g))g=RegExp.$3,f=RegExp.$2||a.packages[g]||f,e=RegExp.$1||e;d[e]||(e="local");return{format:c||d[e][0],domain:d[e][1],mode:d[e][2],domainName:e,packageName:f,name:g,toString:function(){return e+":"+f+"."+g}}}function G(a,b,c){var a=a.cfg,d=b.packageName,e=b.name;if(c==j)c=b.mode;if(c==j)c=a.mode;return b.domain+(c==l.modes.PROD?d:d==a.defaultPackage?e:d+"/"+e)+"."+b.format}function y(a,b,c){var a=a.cfg.processors,d=a[b];d||(d=a[b]=r(function(a){q(a)&&
a()}));d.process(c)}function P(a,b){return function(){var c=arguments,d=A(a,b);y(a,"callComponent",[a,d,c])}}function H(a,b){var c={assets:b};return function(b){if(!c.impl){var e,f;q(b)?(e=function(){b("success")},f=function(){b("error")}):e=f=function(){};x(a,c,e);c.rescue=f;c.impl()}}}var l,i={},D="data-willjs-id",L=/^([\w\-\.]+?)(?:\.min|\-\d+(?:\.\d+)*(?:\w+)?)*\.(?:css|js)$/,I=Array.prototype.slice,K=Object.prototype.toString,J=false,v=m.document;m[B]=l=new w(B);k(i,{call:function(a){return P(this,
a)},use:function(a){return H(this,t(a)?a:I.call(arguments,0))},addComponent:function(a,b){return z(this,this.registry,b,A(this,a))},addProcessor:function(a,b){this.cfg.processors[a]||(this.cfg.processors[a]=r(b))},process:function(a){y(this,a,I.call(arguments,1))},modes:{DEV:0,PROD:1},"u.extend":k,as:function(a){return!a?a:m[a]||(m[a]=new w(a,true))},configure:function(a){s(this,false,a);return this},reconfigure:function(a){s(this,true,a);return this}});k(w.prototype,i);i.u.loadComponent=function(a,
b,c){J?c(500,""):a.use("//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js")(function(d){d==="success"?(i.u.loadComponent=E,E(a,b,c)):(J=true,c(500,""))})};i.u.extend({pathFor:A,urlFor:G,implWrapper:x,newProcessor:r,getConfig:function(){return{cfg:k(new this.Defaults,{processors:new this.Processors,domains:{local:["json","/javascripts/will/"]},packages:{}}),registry:{}}},Processors:function(){},Defaults:function(){}});(function(a){a.callComponent=r(function(a,c,d){var e=this,f=a.registry,g=G(a,
c),h=F(f,c),o=h.impl;if(o)o.apply(j,d);else return c.format=="js"?(g=c.toString().replace(/[:\.]/g,"_")+"@"+g,H(a,[g])(function(a){try{if(a=="success")(o=h.impl)&&o.apply(j,d)}finally{e.sched()}})):l.u.loadComponent(a,g,function(g,i){try{if(g!==200)throw"could not load component: "+c;n(i)&&(i=eval("("+i+")"));if(!p(i))z(a,f,i,c),(o=h.impl)&&o.apply(j,d)}finally{e.sched()}}),false});a.loadDependenciesAndCall=r(function(a,c,d){var e=this,f=a.cfg.debug,g=c.assets||c.libs,h,i;if(g.length)if(h=g[0],i=
M(h)){g.shift();if(i[0])c.lastCss=i[1];c.impl.apply(j,d)}else return f&&f('** loading asset "'+h+'"'),O(a,h,c.lastCss,function(a,b){try{if(a==="success"){g.shift();if(b)c.lastCss=b;c.impl.apply(j,d)}else c.rescue.apply(j,d)}finally{e.sched()}}),false;else c.impl.apply(j,d)})})(i.u.Processors.prototype);k(i.u.Defaults.prototype,{mode:l.modes.DEV,version:"1.2",addDomain:function(a,b,c,d){this.domains[a]=[n(c)?c:c?"js":"json",b+(/\/$/.test(b)?"":"/")];d!=j&&(this.domains[a][2]=d)},defaultPackage:"root",
registerPackage:function(a,b){var c=b.split(/,/),d,e,f;d=this.packages;for(f=0,e=c.length;f<e;)d[c[f++]]=a}});s(l,false)})(window,"will",null);
